(()=>{"use strict";const e={};"undefined"!=typeof lpDataAdmin&&(e.admin={apiAdminNotice:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/admin-notices",apiAdminOrderStatic:lpDataAdmin.lp_rest_url+"lp/v1/orders/statistic",apiAddons:lpDataAdmin.lp_rest_url+"lp/v1/addon/all",apiAddonAction:lpDataAdmin.lp_rest_url+"lp/v1/addon/action",apiAddonsPurchase:lpDataAdmin.lp_rest_url+"lp/v1/addon/info-addons-purchase",apiSearchCourses:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/search-course",apiSearchUsers:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/search-user",apiAssignUserCourse:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/assign-user-course",apiUnAssignUserCourse:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/unassign-user-course",apiAJAX:lpDataAdmin.lp_rest_url+"lp/v1/load_content_via_ajax/"}),"undefined"!=typeof lpData&&(e.frontend={apiWidgets:lpData.lp_rest_url+"lp/v1/widgets/api",apiCourses:lpData.lp_rest_url+"lp/v1/courses/archive-course",apiAJAX:lpData.lp_rest_url+"lp/v1/load_content_via_ajax/"});const t=e,a=(e,t)=>{const a=new URL(e);return Object.keys(t).forEach((e=>{a.searchParams.set(e,t[e])})),a},r="lp-form-course-filter",s="processing";let l,n,o;document.addEventListener("submit",(function(e){const t=e.target;t.classList.contains(r)&&(e.preventDefault(),window.lpCourseFilter.submit(t))})),document.addEventListener("click",(function(e){const t=e.target;t.classList.contains("course-filter-reset")&&(e.preventDefault(),window.lpCourseFilter.reset(t)),window.lpCourseFilter.showHideSearchResult(t),window.lpCourseFilter.triggerInputChoice(t)})),document.addEventListener("keyup",(function(e){e.preventDefault();const t=e.target;t.classList.contains("lp-course-filter-search")&&window.lpCourseFilter.searchSuggestion(t)})),window.lpCourseFilter={searchSuggestion:e=>{if(1!==parseInt(e.dataset.searchSuggest||1))return;const t=e.value.trim(),a=e.closest(`.${r}`),s=a.querySelector(".lp-loading-circle");void 0!==l&&clearTimeout(l),t&&t.length>2?(s.classList.remove("hide"),l=setTimeout((function(){window.lpCourseFilter.callAPICourseSuggest(t,(e=>{document.querySelector(".lp-course-filter-search-result").innerHTML=e.data.content,s.classList.add("hide")}))}),500)):(a.querySelector(".lp-course-filter-search-result").innerHTML="",s.classList.add("hide"))},callAPICourseSuggest:(e,a,r)=>{void 0!==n&&n.abort(),n=new AbortController,o=n.signal;let s=t.frontend.apiCourses+"?c_search="+e+"&c_suggest=1";lpData.urlParams.hasOwnProperty("lang")&&(s+="&lang="+lpData.urlParams.lang);let l={method:"GET"};0!==parseInt(lpData.user_id)&&(l={...l,headers:{"X-WP-Nonce":lpData.nonce}}),fetch(s,{...l,signal:o}).then((e=>e.json())).then((e=>{void 0!==a&&a(e)})).catch((e=>{console.log(e)})).finally((()=>{void 0!==r&&r()}))},loadWidgetFilterREST:e=>{const a=e.closest(`.learnpress-widget-wrapper:not(.${s})`);if(!a)return;a.classList.add(s);const r=e.closest("div[data-widget]");let l=null;if(r){const e=JSON.parse(r.dataset.widget),t=JSON.parse(e.instance).class_list_courses_target||".lp-list-courses-default";l=document.querySelector(t)}const n=a.dataset.widget?JSON.parse(a.dataset.widget):"",o=lpData.urlParams.lang?`?lang=${lpData.urlParams.lang}`:"",i=t.frontend.apiWidgets+o,c=new FormData(e),u={paged:1},p=a.querySelector(".lp-widget-loading-change");p.style.display="block";for(const e of c.entries()){const t=e[0],a=c.getAll(t);if(!u.hasOwnProperty(t)){let e=a;"object"==typeof a&&(e=a.join(",")),u[t]=e}}void 0!==lpData.urlParams.page_term_id_current?u.page_term_id_current=lpData.urlParams.page_term_id_current:void 0!==lpData.urlParams.page_tag_id_current&&(u.page_tag_id_current=lpData.urlParams.page_tag_id_current);const d={params_url:u};lpData.urlParams.hasOwnProperty("lang")?d.params_url.lang=lpData.urlParams.lang:lpData.urlParams.hasOwnProperty("pll-current-lang")&&(d.params_url["pll-current-lang"]=lpData.urlParams["pll-current-lang"]);const g={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,...d})};0!==parseInt(lpData.user_id)&&(g.headers["X-WP-Nonce"]=lpData.nonce),((e,t={},a={})=>{"function"==typeof a.before&&a.before(),fetch(e,{method:"GET",...t}).then((e=>e.json())).then((e=>{"function"==typeof a.success&&a.success(e)})).catch((e=>{"function"==typeof a.error&&a.error(e)})).finally((()=>{"function"==typeof a.completed&&a.completed()}))})(i,g,{before:()=>{},success:t=>{const{data:r,status:s,message:l}=t;r&&"success"===s?e.innerHTML=r:l&&a.insertAdjacentHTML("afterbegin",`<div class="lp-ajax-message error" style="display:block">${l}</div>`)},error:e=>{},completed:()=>{const e=setInterval((()=>{l.classList.contains(s)||(clearInterval(e),p.style.display="none",a.classList.remove(s))}),1)}})},submit:e=>{let r=t.frontend.apiAJAX;const l=new FormData(e),n=document.querySelector(".learn-press-courses"),o=e.closest("div[data-widget]");let i=null;if(o){const e=JSON.parse(o.dataset.widget),t=JSON.parse(e.instance).class_list_courses_target||".lp-list-courses-default";i=document.querySelector(t)}const c={paged:1};void 0!==window.lpCourseList&&window.lpCourseList.updateEventTypeBeforeFetch("filter");for(const e of l.entries()){const t=e[0],a=l.getAll(t);c.hasOwnProperty(t)||(c[t]=a.join(","))}if(void 0!==lpData.urlParams.page_term_id_current&&(c.page_term_id_current=lpData.urlParams.page_term_id_current),void 0!==lpData.urlParams.page_tag_id_current&&(c.page_tag_id_current=lpData.urlParams.page_tag_id_current),lpData.urlParams.hasOwnProperty("lang")?(c.lang=lpData.urlParams.lang,r=a(r,{lang:lpData.urlParams.lang})):lpData.urlParams.hasOwnProperty("pll-current-lang")&&(c["pll-current-lang"]=lpData.urlParams["pll-current-lang"],r=a(r,{lang:lpData.urlParams["pll-current-lang"]})),"undefined"!=typeof lpSettingCourses&&lpData.is_course_archive&&lpSettingCourses.lpArchiveLoadAjax&&n&&!i&&void 0!==window.lpCourseList)window.lpCourseList.triggerFetchAPI(c);else if(i){if(i.classList.contains(s))return;i.classList.add(s);const t=i.querySelector(".lp-target"),l={...JSON.parse(t.dataset.send)},n=i.closest("div:not(.lp-target)").querySelector(".lp-loading-change");n&&(n.style.display="block");const o=e.elements;for(let e=0;e<o.length;e++)c.hasOwnProperty(o[e].name)?l.args[o[e].name]=c[o[e].name]:delete l.args[o[e].name];l.args.paged=1,t.dataset.send=JSON.stringify(l),lpData.urlParams=c,window.history.pushState({},"",a((()=>{let e=window.location.href;return e.includes("?")&&(e=e.split("?")[0]),e})(),lpData.urlParams)),window.lpCourseFilter.loadWidgetFilterREST(e);const u={success:e=>{const{status:a,message:r,data:s}=e;t.innerHTML=s.content||""},error:e=>{console.log(e)},completed:()=>{i.classList.remove(s),n&&(n.style.display="none")}};window.lpAJAXG.fetchAPI(r,l,u)}else{const e=lpData.urlParams.page_term_url||lpData.courses_url||"",t=new URL(e);Object.keys(c).forEach((e=>{t.searchParams.set(e,c[e])})),document.location.href=t.href}},reset:e=>{const t=e.closest(`.${r}`);if(!t)return;const a=t.querySelector(".course-filter-submit"),s=t.querySelector(".lp-course-filter-search-result"),l=t.querySelector(".lp-course-filter-search");t.reset(),s&&(s.innerHTML=""),l&&(l.value="");for(let e=0;e<t.elements.length;e++)t.elements[e].removeAttribute("checked");a.click()},showHideSearchResult:e=>{const t=document.querySelector(".lp-course-filter-search-result");t&&(e.closest(".lp-course-filter-search-result")||e.classList.contains("lp-course-filter-search-result")||e.classList.contains("lp-course-filter-search")?t.style.display="block":t.style.display="none")},triggerInputChoice:e=>{const t=e.closest(".lp-course-filter__field");if(t)if("INPUT"===e.tagName){const e=t.closest("div[data-widget]");let a=null;if(e){const s=JSON.parse(e.dataset.widget),l=JSON.parse(s.instance).class_list_courses_target||".lp-list-courses-default";a=document.querySelector(l),t.closest(`.${r}`).querySelector(".course-filter-submit").click()}}else t.querySelector("input").click()}}})();