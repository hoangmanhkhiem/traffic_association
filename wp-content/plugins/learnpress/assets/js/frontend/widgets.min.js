import{lpFetchAPI}from"../utils";import API from"../api";function widgetRestAPI(){const e=document.querySelectorAll(".learnpress-widget-wrapper:not(.loaded)");if(!e.length)return;e.forEach((e=>{e.classList.add("loaded"),e.classList.contains("learnpress-widget-wrapper__restapi")&&(e=>{const t=lpData.urlParams.lang?`?lang=${lpData.urlParams.lang}`:"",a=e.dataset.widget?JSON.parse(e.dataset.widget):"",s=API.frontend.apiWidgets+t,r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,params_url:lpData.urlParams})};0!==parseInt(lpData.user_id)&&(r.headers["X-WP-Nonce"]=lpData.nonce),lpFetchAPI(s,r,{before:()=>{},success:t=>{const{data:a,status:s,message:r}=t;a&&"success"===s?e.insertAdjacentHTML("afterbegin",a):r&&e.insertAdjacentHTML("afterbegin",`<div class="lp-ajax-message error" style="display:block">${r}</div>`)},error:e=>{},completed:()=>{const t=e.querySelector(".lp-skeleton-animation");t&&t.remove()}})})(e)}))}widgetRestAPI(),document.addEventListener("readystatechange",(e=>{widgetRestAPI()})),document.addEventListener("DOMContentLoaded",(()=>{widgetRestAPI()}));