!function(e){function t(t,a){this.options=e.extend({ID:"",name:"Add new page"},a||{});const i=e(t),n=i.find("select"),s=i.find(".list-pages-wrapper"),o=i.find(".quick-add-page-actions"),r=i.find(".quick-add-page-inline");n.on("change",(function(){o.addClass("hide-if-js"),"add_new_page"===this.value?(s.addClass("hide-if-js"),r.removeClass("hide-if-js").find("input").trigger("focus").val("")):parseInt(this.value)&&(o.find("a.edit-page").attr("href","post.php?post="+this.value+"&action=edit"),o.find("a.view-page").attr("href",lpGlobalSettings.siteurl+"?page_id="+this.value),o.removeClass("hide-if-js"),n.attr("data-selected",this.value))})),n.css("width",n.width()+50).find("option").each((function(){e(this).html(e(this).html().replace(/&nbsp;&nbsp;&nbsp;/g,""))})),n.select2({allowClear:!0,placeholder:lpDataAdmin.i18n.select_page}),n.on("select2:select",(function(e){e.params.data})),i.on("click",".quick-add-page-inline button",(function(){const t=e(this),a=r.find("input"),i=a.val();if(!i)return alert("Please enter the name of page"),void a.trigger("focus");t.prop("disabled",!0);const o=t.closest("tr");let l="";o.length&&(l=o.find(".field_name").attr("name")),e.ajax({url:lpGlobalSettings.ajax,data:{action:"learnpress_create_page",page_name:i,field_name:l,nonce:lpDataAdmin.nonce},type:"post",dataType:"html",success(a){(a=LP.parseJSON(a)).page?(!function(t){const a=e('<option value="'+t.ID+'">'+t.name+"</option>"),i=e.inArray(t.ID+"",t.positions);e(".learn-press-dropdown-pages select").each((function(){const n=e(this),s=a.clone();0===i?e("option",n).each((function(){if(parseInt(e(this).val()))return s.insertBefore(e(this)),!1})):i===t.positions.length-1?n.append(s):s.insertAfter(e('option[value="'+t.positions[i-1]+'"]',n))}))}({ID:a.page.ID,name:a.page.post_title,positions:a.positions}),n.val(a.page.ID).trigger("focus"),n.val(a.page.ID).trigger("change"),r.addClass("hide-if-js")):a.error&&alert(a.error),t.prop("disabled",!1),s.removeClass("hide-if-js")}})})).on("click",".quick-add-page-inline a",(function(e){e.preventDefault(),r.addClass("hide-if-js"),n.val(n.attr("data-selected")+"").removeAttr("disabled").trigger("change"),s.removeClass("hide-if-js")})).on("click",".button-quick-add-page",(function(e){n.val("add_new_page").trigger("change")})).on("keypress keydown",'.quick-add-page-inline input[type="text"]',(function(t){"Enter"==t.key&&"keypress"==t.type?(t.preventDefault(),e(this).siblings("button").trigger("click")):"Escape"==t.key&&"keydown"==t.type&&e(this).siblings("a").trigger("click")}))}e.fn.LP("DropdownPages",(function(){return e.each(this,(function(){let a=e(this).data("DropdownPages");return a||(a=new t(this,{}),e(this).data("DropdownPages",a)),a}))}))}(jQuery);