(()=>{let e;const t=()=>(void 0!==e&&e.abort(),e=new AbortController,e.signal),r=e=>(0!==parseInt(lpData.user_id)&&(e={...e,headers:{"X-WP-Nonce":lpData.nonce}}),e),o=()=>{const e=document.querySelectorAll("#review-form .close");if(null===e)return;const t=document.querySelector(".course-review-wrapper");if(t)for(let r=0;r<e.length;r++)e[r].addEventListener("click",(e=>{e.preventDefault(),t.classList.remove("active")}))},a=()=>{(()=>{const e=document.querySelector(".learnpress-course-review");if(!e)return;((e,a=0)=>{const l=e.querySelector(".lp-skeleton-animation");let n=t();const s=`${lpData.lp_rest_url}lp/v1/review/rating-comment/course/${a}`;let i={method:"GET"};i=r(i),fetch(s,{...i,signal:n}).then((e=>e.json())).then((t=>{if("error"===t.status)throw new Error(t.message||"Error");let r=t.data;r&&e.insertAdjacentHTML("beforeend",r)})).catch((t=>{console.log(t),e.insertAdjacentHTML("beforeend",`<div class="lp-ajax-message error" style="display:block">${t||"Error: Query lp/v1/lazy-load/course-review"}</div>`)})).finally((()=>{})),l&&l.remove(),o();const c=document.querySelectorAll(".review-stars-rated");c&&c.forEach((e=>{e.style.display="flex"})),document.querySelectorAll(".review-stars-rated")&&c.forEach((e=>{e.style.position="relative"}))})(e,e.dataset.id)})(),document.addEventListener("click",(function(e){const a=document.querySelector(".course-review-load-more");if(a&&a.contains(e.target)){a.classList.add("loading");const e=a&&a.dataset.paged,o=a&&a.dataset.id;((e,o,a,l=!1)=>{let n=t();const s=`${lpData.lp_rest_url}lp/v1/review/course/${o}/?page=${a}&show_template=1`;let i={method:"GET"};i=r(i),fetch(s,{...i,signal:n}).then((e=>e.json())).then((t=>{if("error"===t.status)throw new Error(t.message||"Error");let r=t.data;if(e.innerHTML+=r.template,l){l.classList.remove("loading");const e=l.dataset.paged;l.dataset.number===e&&l.remove(),l.dataset.paged=parseInt(e)+1}const o=document.querySelectorAll(".review-stars-rated");o&&o.forEach((e=>{e.style.display="flex"}))})).catch((t=>{console.log(t),e.innerHTML+=`<li class="lp-ajax-message error" style="display:block">${t&&t}</li>`})).finally((()=>{}))})(document.querySelector(".course-reviews-list"),o,e,a)}const l=document.querySelector("li.review-actions .submit-review");if(l&&l.contains(e.target)&&(e=>{const o=e.closest("form").querySelector("ul.review-fields");if(!o)return;const a=o.querySelector('input[name="review_title"]').value||"",l=o.querySelector('textarea[name="review_content"]').value||"",n=Number(o.querySelector('input[name="rating"]').value||0),s=e.dataset.id,i=o.querySelector('input[name="empty_title"]').value,c=o.querySelector('input[name="empty_content"]').value,u=o.querySelector('input[name="empty_rating"]').value;if(0===a.length)return void alert(i);if(0===l.length)return void alert(c);if(0===n)return void alert(u);e.classList.add("loading");let d=t();const v=`${lpData.lp_rest_url}lp/v1/review/submit`;let m=new FormData;m.append("id",s),m.append("rate",n),m.append("title",a),m.append("content",l);let p={method:"POST",body:m};p=r(p),fetch(v,{...p,signal:d}).then((e=>e.json())).then((t=>{if("error"===t.status)throw new Error(t.message||"Error");e.classList.remove("loading"),window.location.reload()})).catch((e=>{console.log(e),o.innerHTML+=`<li class="lp-ajax-message error" style="display:block">${e}</li>`})).finally((()=>{}))})(l),e.target.classList.contains("write-a-review")){const e=document.querySelector(".course-review-wrapper");if(!e)return;(()=>{const e=document.querySelector(".review-form");if(!e)return;const t=e.querySelector("ul.review-stars");if(!t)return;const r=t.querySelectorAll("li.review-title");let a=!1;const l=(e,t)=>{[...e].map((e=>{e.getAttribute("title")<=t?e.querySelector("span").classList.add("hover"):e.querySelector("span").classList.remove("hover")}))};r&&r.forEach(((e,t)=>{const o=e.getAttribute("title");e.addEventListener("mouseover",(()=>{a||l(r,o)})),e.addEventListener("click",(()=>{a=!0,l(r,o),document.querySelector('ul.review-fields li.review-actions input[name="rating"]').value=o}))})),t.addEventListener("mouseout",(()=>{r.forEach((e=>{!a&&e.querySelector("span").classList.remove("hover")}))})),o()})(),e.classList.add("active")}}))};document.addEventListener("DOMContentLoaded",(function(){a()}))})();